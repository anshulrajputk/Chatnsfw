<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ChatNSFW ‚Ä¢ Chat</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  theme:{extend:{
    fontFamily:{sans:['Poppins','Inter','sans-serif']},
    colors:{pinkish:'#ec4899',violetish:'#8b5cf6'}
  }}
}
</script>
<style>
body,html{margin:0;padding:0;height:100%;font-family:'Poppins',sans-serif;background:#111;}
.chat-bg{position:fixed;inset:0;background-size:cover;background-position:center;filter:blur(8px) brightness(.6);z-index:-1;}
.chat-header{background:rgba(0,0,0,.6);backdrop-filter:blur(10px);}
#chatScroller{height:calc(100vh - 120px);overflow-y:auto;padding:80px 1rem 7rem;}
.chat-msg{display:flex;gap:8px;margin:14px 0;opacity:0;transform:translateY(10px);transition:all .3s ease;}
.chat-msg.show{opacity:1;transform:translateY(0);}
.chat-msg.ai img{width:36px;height:36px;border-radius:50%;object-fit:cover;}
.chat-msg.ai .bubble{background:#f1f1f1;color:#111;padding:14px 16px;border-radius:16px;max-width:80%;font-size:14px;line-height:1.4;}
.chat-msg.user{justify-content:flex-end;}
.chat-msg.user .bubble{background:linear-gradient(90deg,#ec4899,#8b5cf6);color:#fff;padding:12px 16px;border-radius:16px;max-width:75%;font-size:14px;line-height:1.4;}
.ai-img{border-radius:16px;overflow:hidden;margin-top:6px;}
.ai-img img{width:220px;border-radius:16px;}
.ai-btn{display:inline-block;cursor:pointer;margin-top:8px;padding:10px 18px;background:#ec4899;color:#fff;border-radius:9999px;font-weight:600;font-size:14px;transition:all .2s;}
.ai-btn:hover{background:#8b5cf6;}
.suggest{font-size:13px;color:#fff;margin-top:6px;}
.suggest span{background:#ec4899;color:#fff;padding:2px 8px;border-radius:6px;font-size:13px;}
.chat-input-wrap{position:fixed;bottom:0;left:0;right:0;background:rgba(0,0,0,.7);backdrop-filter:blur(8px);padding:10px;}
#chatText{flex:1;resize:none;padding:12px;border-radius:20px;background:#fff;color:#111;font-size:14px;border:none;outline:none;}
#sendBtn{width:44px;height:44px;border-radius:50%;background:linear-gradient(90deg,#ec4899,#8b5cf6);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:bold;cursor:pointer;}
.typing-dot{display:inline-block;width:6px;height:6px;margin:0 1px;background:#333;border-radius:50%;animation:blink 1s infinite;}
@keyframes blink{0%,80%,100%{opacity:0;}40%{opacity:1;}}
</style>
</head>
<body>

<div id="bg" class="chat-bg"></div>

<header class="chat-header fixed top-0 left-0 right-0 z-40">
  <div class="max-w-3xl mx-auto flex items-center gap-3 px-4 py-3 text-white">
    <button id="backBtn" class="text-sm opacity-80">‚Üê Return</button>
    <h2 id="chatTitle" class="font-semibold text-[15px]"><span class="text-pinkish">Chat with ...</span></h2>
  </div>
</header>

<main id="chatScroller" class="max-w-3xl mx-auto"></main>

<div class="chat-input-wrap">
  <div class="flex gap-2 max-w-3xl mx-auto items-center">
    <textarea id="chatText" rows="1" placeholder="Press Enter to chat" class="flex-1"></textarea>
    <button id="sendBtn">‚û§</button>
  </div>
</div>

<script>
let currentChar=JSON.parse(localStorage.getItem('cnsfw_currentChar'))||{
  name:"Fannie Wolfe",
  avatar:"https://files.catbox.moe/7ra5pb.png",
  welcomeImage:"https://files.catbox.moe/7ra5pb.png",
  desc:"Fannie Wolfe kneels at your feet, massaging them tenderly as a gesture of devotion. <br><b>Your comfort is all that matters to me. Let me ease your stress, my love.</b>"
};

document.getElementById("bg").style.backgroundImage=`url(${currentChar.welcomeImage})`;
document.getElementById("chatTitle").innerHTML=`<span class="text-pinkish">Chat with ${currentChar.name}</span>`;

const chatScroller=document.getElementById("chatScroller");
const chatText=document.getElementById("chatText");

function createMsg(who,content,type="text"){
  return new Promise(resolve=>{
    const wrap=document.createElement("div");
    wrap.className="chat-msg "+who;
    
    if(who==="ai"){
      const img=document.createElement("img");
      img.src=currentChar.avatar;
      wrap.appendChild(img);
    }

    if(type==="text"){
      const bubble=document.createElement("div");
      bubble.className="bubble";
      bubble.innerHTML=content;
      wrap.appendChild(bubble);
    }
    if(type==="image"){
      const div=document.createElement("div");
      div.className="ai-img";
      div.innerHTML=`<img src="${content}">`;
      wrap.appendChild(div);
    }
    if(type==="button"){
      const btn=document.createElement("div");
      btn.className="ai-btn";
      btn.innerText=content;
      wrap.appendChild(btn);
      btn.addEventListener("click",()=>alert("Button clicked!"));
    }

    chatScroller.appendChild(wrap);
    chatScroller.scrollTop=chatScroller.scrollHeight;

    // Animate like Chatsweetie
    setTimeout(()=>wrap.classList.add("show"),50);
    setTimeout(resolve,300);
  });
}

function showSuggestion(text){
  const sugg=document.createElement("div");
  sugg.className="suggest";
  sugg.innerHTML=`You can say: <span>${text}</span>`;
  chatScroller.appendChild(sugg);
  chatScroller.scrollTop=chatScroller.scrollHeight;
}

/* ‚úÖ Ye function backend se AI reply lane ke liye */
<script>
/* ‚úÖ Ye function backend se AI reply lane ke liye */
async function fetchAIResponse(userMsg){
  try{
    // üî• FIX: localhost hata diya, ab relative API call hai
    const res = await fetch("/chatapi", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: userMsg })
    });
    const data = await res.json();
    return data.reply;
  }catch(err){
    console.error(err);
    return "‚ö†Ô∏è Server se reply nahi mila. Check karo server chal raha hai ya nahi.";
  }
}
</script>

async function sendUserMessage(){
  const text=chatText.value.trim();
  if(!text)return;
  await createMsg("user",text);
  chatText.value="";

  // AI typing simulation
  const typing=await createMsg("ai","<span class='typing-dot'></span><span class='typing-dot'></span><span class='typing-dot'></span>");
  
  // Get reply from backend
  const reply = await fetchAIResponse(text);

  // Remove typing dots & show real reply
  chatScroller.lastChild.remove();
  await createMsg("ai", reply);
}

document.getElementById("sendBtn").addEventListener("click",sendUserMessage);
chatText.addEventListener("keydown",e=>{
  if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();sendUserMessage();}
});
document.getElementById("backBtn").addEventListener("click",()=>window.location.href="index.html");

// Initial sequence like Chatsweetie
(async function initChat(){
  await createMsg("ai",currentChar.desc,"text");
  await createMsg("ai",currentChar.welcomeImage,"image");
  await createMsg("ai","Convert girlfriend into video","button");
  showSuggestion("Hi, how are you doing?");
})();
</script>
</body>
</html>
